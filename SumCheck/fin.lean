import SumCheck.common

noncomputable section
open Classical

namespace NEO

universe u
variable {F : Type u} [Field F]

def finSum (a b : ℕ) := Fin a ⊕ Fin b

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- TRIVIAL DEFS

def finCast (n1 n2 : ℕ) (h : n1 = n2) : Fin n1 → Fin n2 :=
  fun i => (Fin.cast h i)

def finSumCast (a1 b1 a2 b2 : ℕ)
    (ha : a1 = a2) (hb : b1 = b2) :
    finSum a1 b1 → finSum a2 b2 :=
  Sum.map (finCast a1 a2 ha) (finCast b1 b2 hb)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- LAMBDA DEFS

def finZeroAdd (n : ℕ) : Fin (0 + n) → Fin n :=
  fun i => Fin.cast (by simp) i

def finZeroAdd_Inv (n : ℕ) : Fin n → Fin (0 + n) :=
  fun i => Fin.cast (by simp) i

def finZeroAdd_X_Id (a b : ℕ) : Fin (0 + a + b) → Fin (a + b) :=
  fun i => Fin.cast (by simp) i

def finZeroAdd_X_Id_Inv (a b : ℕ) : Fin (a + b) → Fin (0 + a + b) :=
  fun i => Fin.cast (by simp) i

def finId_X_ZeroAdd (a b : ℕ) : Fin (a + (0 + b)) → Fin (a + b) :=
  fun i => Fin.cast (by simp) i

def finId_X_ZeroAdd_Inv (a b : ℕ) : Fin (a + b) → Fin (a + (0 + b)) :=
  fun i => Fin.cast (by simp) i

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- RHO DEFS

def finAddZero (n : ℕ) : Fin (n + 0) → Fin n :=
  fun i => Fin.cast (by simp) i

def finAddZero_Inv (n : ℕ) :  Fin n → Fin (n + 0) :=
  fun i => Fin.cast (by simp) i

def finAddZero_X_Id (a b : ℕ) : Fin (a + 0 + b) → Fin (a + b) :=
  fun i => Fin.cast (by simp) i

def finAddZero_X_Id_X_Id (a b c : ℕ) : Fin (a + 0 + b + c) → Fin (a + b + c) :=
  fun i => Fin.cast (by simp) i

def finAddZero_X_Id_X_Id_Inv (a b c : ℕ) :  Fin (a + b + c) → Fin (a + 0 + b + c) :=
  fun i => Fin.cast (by simp) i

def finAddZero_X_Id_Inv (a b : ℕ) : Fin (a + b) → Fin (a + 0 + b) :=
  fun i => Fin.cast (by simp) i

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- ASSOCITIVITY DEFS

def finAssoc (n k l : ℕ) : Fin (n + k + l) → Fin (n + (k + l)) :=
  fun i => Fin.cast (by rw [Nat.add_assoc]) i

def finAssoc_Inv (n k l : ℕ) : Fin (n + (k + l)) → Fin (n + k + l) :=
  fun i => Fin.cast (by rw [← Nat.add_assoc]) i

def finAssoc_X_Id (a b c d : ℕ) : Fin (a + b + c + d) → Fin (a + (b + c) + d) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finAssoc_X_Id_Inv (a b c d : ℕ) : Fin (a + (b + c) + d) → Fin (a + b + c + d) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finId_X_Assoc (a b c d : ℕ) : Fin (a + (b + c + d)) → Fin (a + (b + (c + d))) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finId_X_Assoc_Inv (a b c d : ℕ) : Fin (a + (b + (c + d))) → Fin (a + (b + c + d)) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finId_X_Id_X_Assoc (x a b c d : ℕ) :
    Fin (x + (a + (b + c + d))) → Fin (x + (a + (b + (c + d)))) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finId_X_Id_X_Assoc_Inv (x a b c d : ℕ) :
    Fin (x + (a + (b + (c + d)))) → Fin (x + (a + (b + c + d))) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finSumAssoc (a b c : ℕ) :
  (Fin a ⊕ Fin b) ⊕ Fin c → Fin a ⊕ (Fin b ⊕ Fin c)
| Sum.inl (Sum.inl i) => Sum.inl i
| Sum.inl (Sum.inr j) => Sum.inr (Sum.inl j)
| Sum.inr k           => Sum.inr (Sum.inr k)

def finSumAssoc_Inv (a b c : ℕ) :
  Fin a ⊕ (Fin b ⊕ Fin c) → (Fin a ⊕ Fin b) ⊕ Fin c
| Sum.inl i             => Sum.inl (Sum.inl i)
| Sum.inr (Sum.inl j)   => Sum.inl (Sum.inr j)
| Sum.inr (Sum.inr k)   => Sum.inr k

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- COMMUTATIVITY DEFS

def finComm (a b : ℕ) : Fin (a + b) → Fin (b + a) :=
  fun i => Fin.cast (by simp [Nat.add_comm]) i

def finLeftComm (a b c : ℕ) : Fin (a + (b + c)) → Fin (b + (a + c)) :=
  fun i => Fin.cast (by rw [Nat.add_left_comm]) i

def finRightComm (a b c : ℕ) : Fin (a + b + c) → Fin (a + c + b) :=
  fun i => Fin.cast (by rw [Nat.add_right_comm]) i

def finComm_X_Id (a b c : ℕ) : Fin (a + b + c) → Fin (b + a + c) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

def finId_X_Comm (a b c : ℕ) : Fin (a + (b + c)) → Fin (a + (c + b)) :=
  fun i => Fin.cast (by simp [Nat.add_comm]) i

def finComm_X_Id_X_Id (a b c d : ℕ) : Fin (a + b + c + d) → Fin (b + a + c + d) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

/-- Swap the middle blocks `b` and `c` inside `a + (b + c) + d`. -/
def finId_X_Comm_XX_Id (a b c d : ℕ) : Fin (a + (b + c) + d) → Fin (a + (c + b) + d) :=
  fun i => Fin.cast (by simp [Nat.add_comm, Nat.add_left_comm]) i

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- Splitting DEFS

def finEmbedHead (a b : ℕ) : Fin a → Fin (a + b) :=
  Fin.castAdd b

def finEmbedTail (a b : ℕ) : Fin b → Fin (a + b) :=
  Fin.natAdd a

def finEmbedHeadConditional (n a b : ℕ) (h : n = a + b) : Fin a → Fin n :=
  finCast (a + b) n h.symm ∘ finEmbedHead a b

def finEmbedTailConditional (n a b : ℕ) (h : n = a + b) : Fin b → Fin n :=
  finCast (a + b) n h.symm ∘ finEmbedTail a b

def finAddToFinSum (a b : ℕ) : Fin (a + b) → (Fin a ⊕ Fin b) :=
  Fin.addCases
    (fun i => Sum.inl i)
    (fun j => Sum.inr j)

def finAddToFinSum_Inv (a b : ℕ) : (Fin a ⊕ Fin b) → Fin (a + b)
| Sum.inl i => Fin.castAdd b i       -- i ↦ i
| Sum.inr j => Fin.natAdd a j        -- j ↦ a + j

def finAddToFinSum_X_Id (a b c : ℕ) :
    (Fin (a + b) ⊕ Fin c) → (Fin a ⊕ Fin b) ⊕ Fin c :=
  Sum.map (finAddToFinSum a b) id

def finAddToFinSum_X_Id_Inv (a b c : ℕ) :
    (Fin a ⊕ Fin b) ⊕ Fin c → (Fin (a + b) ⊕ Fin c) :=
  Sum.map (finAddToFinSum_Inv a b) id

def finId_X_AddToFinSum (a b c : ℕ) :
    (Fin a ⊕ Fin (b + c)) → Fin a ⊕ (Fin b ⊕ Fin c) :=
  Sum.map id (finAddToFinSum b c)

def finId_X_AddToFinSum_Inv (a b c : ℕ) :
    Fin a ⊕ (Fin b ⊕ Fin c) → (Fin a ⊕ Fin (b + c)) :=
  Sum.map id (finAddToFinSum_Inv b c)

def finDesum (n a b : ℕ) (h : n = a + b) : Fin n → Fin (a + b) :=
  finCast n (a + b) h

def finDesum_Inv (n a b : ℕ) (h : n = a + b) : Fin (a + b) → Fin n :=
  finCast (a + b) n h.symm

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- HEAD and TAIL DEFS

def finEmbedHeadSingle (n : ℕ) : Fin 1 → Fin (1 + n) :=
  finEmbedHead (a := 1) (b := n)

def finEmbedTailSingle (n : ℕ) : Fin 1 → Fin (n + 1) :=
  finEmbedTail (a := n) (b := 1)

def finEmbedHeadFull (n : ℕ) : Fin n → Fin (n + 1) :=
  finEmbedHead (a := n) (b := 1)

def finEmbedTailFull (n : ℕ) : Fin n → Fin (1 + n) :=
  finEmbedTail (a := 1) (b := n)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- OTHER DEFS

/-
   Fin a  ─────────────────────────▶  Fin ((i+1) + (a-(i+1)))
-/
def finCastToPrefixOneSuffix (a : ℕ) (i : Fin a) :
    Fin a → Fin ((i.1 + 1) + (a - (i.1 + 1))) :=
  finCast a ((i.1 + 1) + (a - (i.1 + 1)))
    (by
      -- i.1 + 1 ≤ n because i < n
      exact (Nat.add_sub_of_le (Nat.succ_le_of_lt i.2)).symm)

/-
                    id + finCastToPrefixOneSuffix
   Fin (a + b)  ───────────────────────────────────────▶  Fin (a + ((i+1) + (b-(i+1))))
-/
def finId_X_CastToPrefixOneSuffix (a b : ℕ) (i : Fin b) :
    Fin (a + b) → Fin (a + ((i.1 + 1) + (b - (i.1 + 1)))) :=
by
  exact
    finCast (a + b) (a + ((i.1 + 1) + (b - (i.1 + 1))))
      (by
        simpa using congrArg
          (Nat.add a)
          (Nat.add_sub_of_le (Nat.succ_le_of_lt i.2)).symm)


/- Fin (b + a - a)  ─────── finRightCancell ───────▶  Fin b -/
def finRightCancell (a b : ℕ) : Fin (b + a - a) → Fin b :=
  Fin.cast (by simp)

/- Fin b  ─────── finRightCancell_Inv ───────▶  Fin (b + a - a) -/
def finRightCancell_Inv (a b : ℕ) : Fin b → Fin (b + a - a) :=
  Fin.cast (by simp)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin (b + a - a)  ─── finSumId_X_RightCancell ───▶  Fin a ⊕ Fin b
-/
def finSumId_X_RightCancell (a b : ℕ) :
    Fin a ⊕ Fin (b + a - a) → Fin a ⊕ Fin b :=
  Sum.map id (finRightCancell a b)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin b  ─── finSumId_X_RightCancell_Inv ───▶  Fin a ⊕ Fin (b + a - a)
-/
def finSumId_X_RightCancell_Inv (a b : ℕ) :
    Fin a ⊕ Fin b → Fin a ⊕ Fin (b + a - a) :=
  Sum.map id (finRightCancell_Inv a b)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + c - (b + c))  ─────── finRightSubtr ───────▶  Fin (a - b)
-/
def finRightSubtr (a b c : ℕ) : Fin (a + c - (b + c)) → Fin (a - b) :=
  Fin.cast (by simp [Nat.add_sub_add_right])

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a - b)  ─────── finRightSubtr_Inv ───────▶  Fin (a + c - (b + c))
-/
def finRightSubtr_Inv (a b c : ℕ) : Fin (a - b) → Fin (a + c - (b + c)) :=
  Fin.cast (by simp [Nat.add_sub_add_right])

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + (b + a - a))  ─── finId_X_RightCancell ───▶  Fin (a + b)
-/
def finId_X_RightCancell (a b : ℕ) :
    Fin (a + (b + a - a)) → Fin (a + b) :=
  Fin.cast (by simp)


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + b)  ─── finId_X_RightCancell_Inv ───▶  Fin (a + (b + a - a))
-/
def finId_X_RightCancell_Inv (a b : ℕ) :
    Fin (a + b) → Fin (a + (b + a - a)) :=
  Fin.cast (by simp)

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin (b + c)  ─── finSumId_X_finComm ───▶  Fin a ⊕ Fin (c + b)
-/
def finSumId_X_finComm (a b c : ℕ) :
    Fin a ⊕ Fin (b + c) → Fin a ⊕ Fin (c + b) :=
  Sum.map id (finComm b c)


-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================
-- ==========================================================================

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- TRIVIAL THEOREM

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finCast_rfl:

Fin n  ---- finCast n n rfl ----▶  Fin n
  |                                   |
  | id                                | id
  ▼                                   ▼
Fin n  ---------- id -----------▶  Fin n
-/
@[simp]
theorem finCast_rfl {n : ℕ} :
  finCast (n1 := n) (n2 := n) rfl = id
  := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finCast_involutive:

Fin n1  ---- finCast h ----▶  Fin n2  ---- finCast h.symm ----▶  Fin n1
  |                                                              |
  | id                                                           | id
  ▼                                                              ▼
Fin n1  --------------------------- id --------------------------▶  Fin n1

i.e.  finCast h.symm ∘ finCast h = id
-/
@[simp]
theorem finCast_involutive (n1 n2 : ℕ) (h : n1 = n2) :
  (finCast (n1 := n2) (n2 := n1) h.symm) ∘
    (finCast (n1 := n1) (n2 := n2) h) = id
  := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finZeroAdd_is_finCast0:

Fin (0 + n)  ---- finZeroAdd n ----▶  Fin n
     |                                   |
     | (definitionally same map)         | id
     ▼                                   ▼
Fin (0 + n)  ---- finCast (by simp) ----▶  Fin n

i.e. finZeroAdd n = finCast (0+n) n (by simp)
-/
-- @[simp]
theorem finZeroAdd_is_finCast0 (n : ℕ) :
  finZeroAdd n = finCast (0 + n) n (by simp)
  := by
    rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finZeroAdd_Inv_is_finCast0:

Fin n  ---- finZeroAdd_Inv n ----▶  Fin (0 + n)
  |                                   |
  | (definitionally same map)         | id
  ▼                                   ▼
Fin n  ---- finCast (by simp) ----▶  Fin (0 + n)

i.e. finZeroAdd_Inv n = finCast n (0+n) (by simp)
-/
-- @[simp]
theorem finZeroAdd_Inv_is_finCast0 (n : ℕ) :
  finZeroAdd_Inv n = finCast n (0 + n) (by simp)
  := by
    rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finAddZero_is_finCast0:

Fin (n + 0)  ---- finAddZero n ----▶  Fin n
     |                                   |
     | (definitionally same map)         | id
     ▼                                   ▼
Fin (n + 0)  ---- finCast (by simp) ----▶  Fin n

i.e. finAddZero n = finCast (n+0) n (by simp)
-/
-- @[simp]
theorem finAddZero_is_finCast0 (n : ℕ) :
  finAddZero n = finCast (n + 0) n (by simp)
  := by
    rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finAddZero_Inv_is_finCast0:

Fin n  ---- finAddZero_Inv n ----▶  Fin (n + 0)
  |                                   |
  | (definitionally same map)         | id
  ▼                                   ▼
Fin n  ---- finCast (by simp) ----▶  Fin (n + 0)

i.e. finAddZero_Inv n = finCast n (n+0) (by simp)
-/
-- @[simp]
theorem finAddZero_Inv_is_finCast0 (n : ℕ) :
  finAddZero_Inv n = finCast n (n + 0) (by simp)
  := by
    rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- LAMBDA THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finZeroAdd ∘ finZeroAdd_Inv) = id

Diagram:

        finZeroAdd_Inv n
Fin n  ----▶  Fin (0 + n)
  |                |
  | id             | finZeroAdd n
  ▼                ▼
Fin n  ◀----  Fin n
        identity
-/
@[simp]
theorem finZeroAdd_finZeroAdd_Inv_is_id
  (n : ℕ) :
    (finZeroAdd n) ∘ (finZeroAdd_Inv n) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finZeroAdd_Inv ∘ finZeroAdd) = id

Diagram:

        finZeroAdd n
Fin (0 + n)  ----▶  Fin n
     |                   |
     | id                | finZeroAdd_Inv n
     ▼                   ▼
Fin (0 + n)  ◀----  Fin (0 + n)
         identity
-/
@[simp]
theorem finZeroAdd_Inv_finZeroAdd_is_id
  (n : ℕ) :
    (finZeroAdd_Inv n) ∘ (finZeroAdd n) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_ZeroAdd ∘ finId_X_ZeroAdd_Inv) = id

Diagram:

        finId_X_ZeroAdd_Inv a b
Fin (a + b)  ----▶  Fin (a + (0 + b))
      |                          |
      | id                       | finId_X_ZeroAdd a b
      ▼                          ▼
Fin (a + b)  ◀----  Fin (a + b)
          identity
-/
@[simp]
theorem finId_X_ZeroAdd_finId_X_ZeroAdd_Inv_is_id
  (a b : ℕ) :
    (finId_X_ZeroAdd a b) ∘ (finId_X_ZeroAdd_Inv a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_ZeroAdd_Inv ∘ finId_X_ZeroAdd) = id

Diagram:

        finId_X_ZeroAdd a b
Fin (a + (0 + b))  ----▶  Fin (a + b)
        |                          |
        | id                       | finId_X_ZeroAdd_Inv a b
        ▼                          ▼
Fin (a + (0 + b))  ◀----  Fin (a + (0 + b))
               identity
-/
@[simp]
theorem finId_X_ZeroAdd_Inv_finId_X_ZeroAdd_is_id
  (a b : ℕ) :
    (finId_X_ZeroAdd_Inv a b) ∘ (finId_X_ZeroAdd a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finZeroAdd_X_Id ∘ finZeroAdd_X_Id_Inv) = id

Diagram:

        finZeroAdd_X_Id_Inv a b
Fin ((0 + a) + b)  ----▶  Fin (a + b)
        |                          |
        | id                       | finZeroAdd_X_Id a b
        ▼                          ▼
Fin ((0 + a) + b)  ◀----  Fin ((0 + a) + b)
                identity
-/
@[simp]
theorem finZeroAdd_X_Id_finZeroAdd_X_Id_Inv_is_id
  (a b : ℕ) :
    (finZeroAdd_X_Id a b) ∘ (finZeroAdd_X_Id_Inv a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finZeroAdd_X_Id_Inv ∘ finZeroAdd_X_Id) = id

Diagram:

        finZeroAdd_X_Id a b
Fin (a + b)  ----▶  Fin ((0 + a) + b)
        |                          |
        | id                       | finZeroAdd_X_Id_Inv a b
        ▼                          ▼
Fin (a + b)  ◀----  Fin (a + b)
            identity
-/
@[simp]
theorem finZeroAdd_X_Id_Inv_finZeroAdd_X_Id_is_id
  (a b : ℕ) :
    (finZeroAdd_X_Id_Inv a b) ∘ (finZeroAdd_X_Id a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- RHO THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin n  -- finAddZero_Inv n -->  Fin (n + 0)
     \                              |
      \                             | finAddZero n
       \                            ▼
        \---- id ---------------->  Fin n
-/
@[simp]
theorem finAddZero_finAddZero_Inv_is_id
  (n : ℕ) :
    (finAddZero n) ∘ (finAddZero_Inv n) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (n + 0)  -- finAddZero n -->  Fin n
        \                          |
         \                         | finAddZero_Inv n
          \                        ▼
           \---- id ------------>  Fin (n + 0)
-/
@[simp]
theorem finAddZero_Inv_finAddZero_is_id
  (n : ℕ) :
    (finAddZero_Inv n) ∘ (finAddZero n) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + b)  -- finAddZero_X_Id_Inv a b -->  Fin (a + 0 + b)
        \                                       |
         \                                      | finAddZero_X_Id a b
          \                                     ▼
           \---- id -------------------------->  Fin (a + b)
-/
@[simp]
theorem finAddZero_X_Id_finAddZero_X_Id_Inv_is_id
  (a b : ℕ) :
    (finAddZero_X_Id a b) ∘ (finAddZero_X_Id_Inv a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + 0 + b)  -- finAddZero_X_Id a b -->  Fin (a + b)
          \                                   |
           \                                  | finAddZero_X_Id_Inv a b
            \                                 ▼
             \---- id ---------------------->  Fin (a + 0 + b)
-/
@[simp]
theorem finAddZero_X_Id_Inv_finAddZero_X_Id_is_id
  (a b : ℕ) :
    (finAddZero_X_Id_Inv a b) ∘ (finAddZero_X_Id a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + b + c)  -- finAddZero_X_Id_X_Id_Inv a b c -->  Fin (a + 0 + b + c)
          \                                                   |
           \                                                  | finAddZero_X_Id_X_Id a b c
            \                                                 ▼
             \---- id -------------------------------------->  Fin (a + b + c)
-/
@[simp]
theorem finAddZero_X_Id_X_Id_finAddZero_X_Id_X_Id_Inv_is_id (a b c : ℕ) :
  (finAddZero_X_Id_X_Id (a := a) (b := b) (c := c)) ∘
      (finAddZero_X_Id_X_Id_Inv (a := a) (b := b) (c := c))
    =
  id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + 0 + b + c)  -- finAddZero_X_Id_X_Id a b c -->  Fin (a + b + c)
            \                                               |
             \                                              | finAddZero_X_Id_X_Id_Inv a b c
              \                                             ▼
               \---- id ---------------------------------->  Fin (a + 0 + b + c)
-/
@[simp]
theorem finAddZero_X_Id_X_Id_Inv_finAddZero_X_Id_X_Id_is_id (a b c : ℕ) :
  (finAddZero_X_Id_X_Id_Inv (a := a) (b := b) (c := c)) ∘
      (finAddZero_X_Id_X_Id (a := a) (b := b) (c := c))
    =
  id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- ASSOCITIVITY THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finAssoc_X_Id ∘ finAssoc_X_Id_Inv) = id

Diagram:

        finAssoc_X_Id_Inv a b c d
Fin ((a + b) + c + d)  ----▶  Fin (a + (b + c) + d)
           |                                |
           | id                             | finAssoc_X_Id a b c d
           ▼                                ▼
Fin ((a + b) + c + d)  ◀----  Fin ((a + b) + c + d)
                 identity
-/
@[simp]
theorem finAssoc_X_Id_finAssoc_X_Id_Inv_is_id
  (a b c d : ℕ) :
    (finAssoc_X_Id a b c d) ∘ (finAssoc_X_Id_Inv a b c d) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finAssoc_X_Id_Inv ∘ finAssoc_X_Id) = id

Diagram:

        finAssoc_X_Id a b c d
Fin (a + (b + c) + d)  ----▶  Fin ((a + b) + c + d)
           |                                |
           | id                             | finAssoc_X_Id_Inv a b c d
           ▼                                ▼
Fin (a + (b + c) + d)  ◀----  Fin (a + (b + c) + d)
                 identity
-/
@[simp]
theorem finAssoc_X_Id_Inv_finAssoc_X_Id_is_id
  (a b c d : ℕ) :
    (finAssoc_X_Id_Inv a b c d) ∘ (finAssoc_X_Id a b c d) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finAssoc ∘ finAssoc_Inv) = id

Diagram:

        finAssoc_Inv n k l
Fin ((n + k) + l)  ----▶  Fin (n + (k + l))
        |                          |
        | id                       | finAssoc n k l
        ▼                          ▼
Fin ((n + k) + l)  ◀----  Fin ((n + k) + l)
            identity
-/
@[simp]
theorem finAssoc_finAssoc_Inv_is_id
  (n k l : ℕ) :
    (finAssoc n k l) ∘ (finAssoc_Inv n k l) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finAssoc_Inv ∘ finAssoc) = id

Diagram:

        finAssoc n k l
Fin (n + (k + l))  ----▶  Fin ((n + k) + l)
        |                          |
        | id                       | finAssoc_Inv n k l
        ▼                          ▼
Fin (n + (k + l))  ◀----  Fin (n + (k + l))
            identity
-/
@[simp]
theorem finAssoc_Inv_finAssoc_is_id
  (n k l : ℕ) :
    (finAssoc_Inv n k l) ∘ (finAssoc n k l) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_Assoc ∘ finId_X_Assoc_Inv) = id

Diagram:

        finId_X_Assoc_Inv a b c d
Fin (a + ((b + c) + d))  ----▶  Fin (a + (b + (c + d)))
            |                                  |
            | id                               | finId_X_Assoc a b c d
            ▼                                  ▼
Fin (a + ((b + c) + d))  ◀----  Fin (a + ((b + c) + d))
                   identity
-/
@[simp]
theorem finId_X_Assoc_finId_X_Assoc_Inv_is_id
  (a b c d : ℕ) :
    (finId_X_Assoc a b c d) ∘ (finId_X_Assoc_Inv a b c d) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_Assoc_Inv ∘ finId_X_Assoc) = id

Diagram:

        finId_X_Assoc a b c d
Fin (a + (b + (c + d)))  ----▶  Fin (a + ((b + c) + d))
            |                                  |
            | id                               | finId_X_Assoc_Inv a b c d
            ▼                                  ▼
Fin (a + (b + (c + d)))  ◀----  Fin (a + (b + (c + d)))
                   identity
-/
@[simp]
theorem finId_X_Assoc_Inv_finId_X_Assoc_is_id
  (a b c d : ℕ) :
    (finId_X_Assoc_Inv a b c d) ∘ (finId_X_Assoc a b c d) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_Id_X_Assoc_Inv ∘ finId_X_Id_X_Assoc) = id

          finId_X_Id_X_Assoc a b c d e
Fin (a + (b + (c + d)) + e)  ------------------▶  Fin ((a + b) + (c + d) + e)
        |                                                                  |
        | id                                          finId_X_Id_X_Assoc_Inv a b c d e
        ▼                                                                  ▼
Fin (a + (b + (c + d)) + e)  ◀------------------  Fin (a + (b + (c + d)) + e)
                     identity
-/
@[simp]
theorem finId_X_Id_X_Assoc_Inv_finId_X_Id_X_Assoc_is_id
  (a b c d e : ℕ) :
    (finId_X_Id_X_Assoc_Inv a b c d e) ∘ (finId_X_Id_X_Assoc a b c d e) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
(finId_X_Id_X_Assoc ∘ finId_X_Id_X_Assoc_Inv) = id

Diagram:

        finId_X_Id_X_Assoc_Inv a b c d e
Fin ((a + b) + (c + d) + e)  ----▶  Fin (a + (b + (c + d)) + e)
        |                                   |
        | id                                | finId_X_Id_X_Assoc a b c d e
        ▼                                   ▼
Fin ((a + b) + (c + d) + e)  ◀----  Fin ((a + b) + (c + d) + e)
                identity
-/
@[simp]
theorem finId_X_Id_X_Assoc_finId_X_Id_X_Assoc_Inv_is_id
  (a b c d e : ℕ) :
    (finId_X_Id_X_Assoc a b c d e) ∘ (finId_X_Id_X_Assoc_Inv a b c d e) = id := by
  rfl


@[simp] theorem finSumAssoc_finSumAssoc_Inv_is_id (a b c : ℕ) :
    (finSumAssoc a b c) ∘ (finSumAssoc_Inv a b c) = id := by
  funext x
  cases x with
  | inl i =>
      rfl
  | inr bc =>
      cases bc with
      | inl j => rfl
      | inr k => rfl

@[simp] theorem finSumAssoc_Inv_finSumAssoc_is_id (a b c : ℕ) :
    (finSumAssoc_Inv a b c) ∘ (finSumAssoc a b c) = id := by
  funext x
  cases x with
  | inl ab =>
      cases ab with
      | inl i => rfl
      | inr j => rfl
  | inr k =>
      rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- COMMUTATIVITY THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finComm is involutive:

        finComm a b
Fin (a + b)  ----▶  Fin (b + a)
     |                     |
     | id                  | finComm b a
     ▼                     ▼
Fin (a + b)  ◀----  Fin (a + b)
         identity
-/
@[simp]
theorem finComm_involutive (a b : ℕ) :
  (finComm b a) ∘ (finComm a b) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finComm_X_Id is involutive:

        finComm_X_Id a b c
Fin (a + b + c)  ----▶  Fin (b + a + c)
         |                        |
         | id                     | finComm_X_Id b a c
         ▼                        ▼
Fin (a + b + c)  ◀----  Fin (a + b + c)
             identity
-/
@[simp]
theorem finComm_X_Id_involutive (a b c : ℕ) :
  (finComm_X_Id b a c) ∘ (finComm_X_Id a b c) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finId_X_Comm is involutive:

        finId_X_Comm a b c
Fin (a + (b + c))  ----▶  Fin (a + (c + b))
           |                         |
           | id                      | finId_X_Comm a c b
           ▼                         ▼
Fin (a + (b + c))  ◀----  Fin (a + (b + c))
                identity
-/
theorem finId_X_Comm_involutive (a b c : ℕ) :
  (finId_X_Comm a c b) ∘ (finId_X_Comm a b c) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
finId_X_Comm_XX_Id is involutive:

        finId_X_Comm_XX_Id a b c d
Fin (a + (b + c) + d)  ----▶  Fin (a + (c + b) + d)
                |                           |
                | id                        | finId_X_Comm_XX_Id a c b d
                ▼                           ▼
Fin (a + (b + c) + d)  ◀----  Fin (a + (b + c) + d)
                     identity
-/
@[simp]
theorem finId_X_Comm_XX_Id_involutive (a b c d : ℕ) :
  (finId_X_Comm_XX_Id a c b d) ∘ (finId_X_Comm_XX_Id a b c d) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- MIXED THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
             finZeroAdd_Inv
   Fin n  ----------------------▶  Fin (0 + n)
     \                               |
      \                              | finComm 0 n
       \                             ▼
        \--------- finAddZero_Inv --> Fin (n + 0)
-/
@[simp]
theorem finComm_finZeroAddInv_is_finAddZeroInv (n : ℕ) :
  (finComm 0 n) ∘ (finZeroAdd_Inv n) = finAddZero_Inv n := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                          finAssoc (a+b) c d
   Fin (((a+b)+c)+d)  --------------------------▶  Fin ((a+b)+(c+d))
        |                                              |
        | finComm_X_Id_X_Id a b c d                    | finComm_X_Id a b (c+d)
        ▼                                              ▼
   Fin (((b+a)+c)+d)  --------------------------▶  Fin ((b+a)+(c+d))
                          finAssoc (b+a) c d
-/
@[simp]
theorem finComm_X_Id_finAssoc_is_finAssoc_finComm_X_Id_Id
  (a b c d : ℕ) :
  (finComm_X_Id a b (c + d)) ∘ (finAssoc (a + b) c d)
  =
  (finAssoc (b + a) c d) ∘ (finComm_X_Id_X_Id a b c d)
  := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
              finAssoc (a+b) c d
A: Fin (((a+b)+c)+d)  ----------------------▶  B: Fin ((a+b)+(c+d))
        |                                             |
        | finAssoc_X_Id a b c d                       | finAssoc a b (c+d)
        ▼                                             |
C: Fin ((a+(b+c))+d)                                  |
        |                                             |
        | finAssoc a (b+c) d                          |
        ▼                                             ▼
D: Fin (a+((b+c)+d))  ----------------------▶  E: Fin (a+(b+(c+d)))
              finId_X_Assoc a b c d
-/
@[simp]
theorem finPentagonIdentity
  (a b c d : ℕ) :
    (finId_X_Assoc a b c d)
      ∘ (finAssoc a (b + c) d)
      ∘ (finAssoc_X_Id a b c d)
    =
    (finAssoc a b (c + d))
      ∘ (finAssoc (a + b) c d)
  := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- Splitting THEOREMS

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin b  -- finSumToFinAdd -->  Fin (a + b)
        \                               |
         \                              | finAddToFinSum
          \                             v
           \---- id ----------------->  Fin a ⊕ Fin b
-/
@[simp]
theorem finAddToFinSum_finAddToFinSum_Inv_is_id (a b : ℕ) :
    (finAddToFinSum a b) ∘ (finAddToFinSum_Inv a b) = id := by
  funext x
  cases x with
  | inl i =>
      -- goal: finAddToFinSum a b (Fin.castAdd b i) = Sum.inl i
      simp [finAddToFinSum, finAddToFinSum_Inv, Function.comp]
  | inr j =>
      -- goal: finAddToFinSum a b (Fin.natAdd a j) = Sum.inr j
      simp [finAddToFinSum, finAddToFinSum_Inv, Function.comp]

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + b)  -- finAddToFinSum -->  Fin a ⊕ Fin b
      \                              |
       \                             | finSumToFinAdd
        \                            v
         \---- id ---------------->  Fin (a + b)
-/
@[simp]
theorem finAddToFinSum_Inv_finAddToFinSum_is_id (a b : ℕ) :
    (finAddToFinSum_Inv a b) ∘ (finAddToFinSum a b) = id := by
  funext i
  -- split i : Fin (a+b) into the two blocks via Fin.addCases
  refine Fin.addCases (fun i => ?_) (fun j => ?_) i
  · -- i : Fin a
    simp [finAddToFinSum, finAddToFinSum_Inv, Function.comp]
  · -- j : Fin b
    simp [finAddToFinSum, finAddToFinSum_Inv, Function.comp]

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin n  -- finDesum -->  Fin a ⊕ Fin b
     \                       |
      \                      | finDesum_Inv
       \                     v
        \---- id --------->  Fin n
-/
@[simp]
theorem finDesum_Inv_finDesum_is_id (n a b : ℕ) (h : n = a + b) :
    (finDesum_Inv (n := n) (a := a) (b := b) h) ∘ (finDesum (n := n) (a := a) (b := b) h) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin b  -- finDesum_Inv -->  Fin n
        \                            |
         \                           | finDesum
          \                          v
           \---- id -------------->  Fin a ⊕ Fin b
-/
@[simp]
theorem finDesum_finDesum_Inv_is_id (n a b : ℕ) (h : n = a + b) :
    (finDesum (n := n) (a := a) (b := b) h) ∘ (finDesum_Inv (n := n) (a := a) (b := b) h) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                    finAddToFinSum
   Fin (a + b) ─────────────────────────▶ Fin a ⊕ Fin b
        │                                     │
        │ finCast                             │ finSumCast
        ▼                                     ▼
   Fin (a' + b') ───────────────────────▶ Fin a' ⊕ Fin b'
                    finAddToFinSum
-/
@[simp]
theorem finSumCast_finAddToFinSum_is_finAddToFinSum_finCast (a1 b1 a2 b2 : ℕ)
    (ha : a1 = a2) (hb : b1 = b2) :
    (finSumCast a1 b1 a2 b2 ha hb) ∘ (finAddToFinSum a1 b1)
    =
    (finAddToFinSum a2 b2) ∘ (finCast (a1 + b1) (a2 + b2) (by rw [ha, hb]))
  := by
  cases ha
  cases hb
  -- now everything is "same indices", so it's just id ∘ f = f ∘ id
  simp [finSumCast]

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin a ⊕ Fin b  ── finSumToFinAdd ──▶  Fin (a + b)
        │                                   │
        │ finSumCast                        │ finCast
        ▼                                   ▼
   Fin a' ⊕ Fin b' ─ finSumToFinAdd ─▶ Fin (a' + b')
-/
@[simp]
theorem finCast_finSumToFinAdd_is_finSumToFinAdd_finSumCast
  (a b a' b' : ℕ) (ha : a = a') (hb : b = b') :
    (finCast (a + b) (a' + b') (by rw [ha, hb])) ∘ (finAddToFinSum_Inv a b)
      =
    (finAddToFinSum_Inv a' b') ∘ (finSumCast a b a' b' ha hb) := by
  cases ha
  cases hb
  simp [finSumCast]

@[simp]
theorem finId_X_AddToFinSum_finId_X_AddToFinSum_Inv_is_id
  (a b c : ℕ) :
  (finId_X_AddToFinSum a b c) ∘ (finId_X_AddToFinSum_Inv a b c) = id := by
  funext x
  cases x with
  | inl ia =>
      -- left block: Fin a
      simp [finId_X_AddToFinSum, finId_X_AddToFinSum_Inv, Function.comp, Sum.map, id]
  | inr ibc =>
      -- right block: Fin b ⊕ Fin c
      -- reduces to finAddToFinSum ∘ finAddToFinSum_Inv = id
      simp [finId_X_AddToFinSum, finId_X_AddToFinSum_Inv,
            Function.comp, Sum.map, id]
      exact congrArg (fun f => f ibc) (finAddToFinSum_finAddToFinSum_Inv_is_id b c)

@[simp]
theorem finId_X_AddToFinSum_Inv_finId_X_AddToFinSum_is_id
  (a b c : ℕ) :
  (finId_X_AddToFinSum_Inv a b c) ∘ (finId_X_AddToFinSum a b c) = id := by
  funext x
  cases x with
  | inl ia =>
      -- left block: Fin a
      simp [finId_X_AddToFinSum, finId_X_AddToFinSum_Inv, Function.comp, Sum.map, id]
  | inr ibc =>
      -- right block: Fin (b + c)
      -- reduces to finAddToFinSum_Inv ∘ finAddToFinSum = id
      simp [finId_X_AddToFinSum, finId_X_AddToFinSum_Inv,
            Function.comp, Sum.map, id]
      exact congrArg (fun f => f ibc) (finAddToFinSum_Inv_finAddToFinSum_is_id b c)

@[simp]
theorem finAddToFinSum_X_Id_finAddToFinSum_X_Id_Inv_is_id
  (a b c : ℕ) :
  (finAddToFinSum_X_Id a b c) ∘ (finAddToFinSum_X_Id_Inv a b c) = id := by
  funext x
  cases x with
  | inl ab =>
      -- ab : Fin a ⊕ Fin b
      cases ab with
      | inl ia =>
          unfold finAddToFinSum_X_Id finAddToFinSum_X_Id_Inv
          unfold Sum.map
          unfold Sum.elim
          rw [Function.comp_id, Function.comp_id]
          unfold id
          simp
          exact congrArg (fun f => f (Sum.inl ia)) (finAddToFinSum_finAddToFinSum_Inv_is_id a b)
      | inr ib =>
          unfold finAddToFinSum_X_Id finAddToFinSum_X_Id_Inv
          unfold Sum.map
          unfold Sum.elim
          rw [Function.comp_id, Function.comp_id]
          unfold id
          simp
          exact congrArg (fun f => f (Sum.inr ib)) (finAddToFinSum_finAddToFinSum_Inv_is_id a b)
  | inr ic =>
      simp [finAddToFinSum_X_Id, finAddToFinSum_X_Id_Inv,
            Function.comp, Sum.map, id]

@[simp]
theorem finAddToFinSum_X_Id_Inv_finAddToFinSum_X_Id_is_id
  (a b c : ℕ) :
  (finAddToFinSum_X_Id_Inv a b c) ∘ (finAddToFinSum_X_Id a b c) = id := by
  funext x
  cases x with
  | inl iab =>
      -- iab : Fin (a + b)
      simp [finAddToFinSum_X_Id, finAddToFinSum_X_Id_Inv,
            Function.comp, Sum.map, id]
      exact congrArg (fun f => f (iab)) (finAddToFinSum_Inv_finAddToFinSum_is_id a b)
  | inr ic =>
      simp [finAddToFinSum_X_Id, finAddToFinSum_X_Id_Inv,
            Function.comp, Sum.map, id]


@[simp]
theorem finHexagon_Inv
  (a b c : ℕ) :
  (finAssoc_Inv a b c)
    ∘ (finAddToFinSum_Inv a (b + c))
    ∘ (finId_X_AddToFinSum_Inv a b c)
  =
  (finAddToFinSum_Inv (a + b) c)
    ∘ (finAddToFinSum_X_Id_Inv a b c)
    ∘ (finSumAssoc_Inv a b c)
  := by
  funext x
  cases x with
  | inl ia =>
      -- x = ia in the a-block
      ext
      simp [finAssoc_Inv, finAddToFinSum_Inv, finId_X_AddToFinSum_Inv,
            finAddToFinSum_X_Id_Inv, finSumAssoc_Inv, Function.comp, Fin.cast]
  | inr xbc =>
      cases xbc with
      | inl jb =>
          -- x = jb in the b-block
          ext
          simp [finAssoc_Inv, finAddToFinSum_Inv, finId_X_AddToFinSum_Inv,
                finAddToFinSum_X_Id_Inv, finSumAssoc_Inv, Function.comp, Fin.cast]
      | inr kc =>
          -- x = kc in the c-block
          ext
          simp [finAssoc_Inv, finAddToFinSum_Inv, finId_X_AddToFinSum_Inv,
                finAddToFinSum_X_Id_Inv, finSumAssoc_Inv, Function.comp, Fin.cast]
          rw [← Nat.add_assoc]

@[simp]
theorem finHexagon
  (a b c : ℕ) :
    (finSumAssoc a b c)
      ∘ (finAddToFinSum_X_Id a b c)
      ∘ (finAddToFinSum (a + b) c)
    =
    (finId_X_AddToFinSum a b c)
      ∘ (finAddToFinSum a (b + c))
      ∘ (finAssoc a b c)
  := by
  have h0 := finHexagon_Inv a b c
  have h1 := compLeft (finAssoc a b c) h0
  simp [← Function.comp_assoc] at h1
  have h2 := compLeft (finAddToFinSum a (b + c)) h1
  simp [← Function.comp_assoc] at h2
  have h3 := compLeft (finId_X_AddToFinSum a b c) h2
  simp at h3
  have h4 := compRight (finSumAssoc a b c) h3
  simp [Function.comp_assoc] at h4
  have h5 := compRight (finAddToFinSum_X_Id a b c) h4
  simp [Function.comp_assoc] at h5
  have h6 := compRight (finAddToFinSum (a + b) c) h5
  simp [Function.comp_assoc] at h6
  exact h6


@[simp]
theorem finHexagon1 (a b c : ℕ) :
  (finSumAssoc a b c)
    ∘ (finAddToFinSum_X_Id a b c)
    ∘ (finAddToFinSum (a + b) c)
  =
  (finId_X_AddToFinSum a b c)
    ∘ (finAddToFinSum a (b + c))
    ∘ (finAssoc a b c)
  := by
  simpa [Function.comp_assoc]
    using
      compRight _ (compRight _ (compRight _ (compLeft _ (compLeft _ (compLeft _ (finHexagon_Inv a b c))))))



-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

-- OTHER THEOREMS

/-
                   finRightCancell_Inv
   Fin b  ─────────────────────────────────────────▶  Fin (b + a - a)
     │                                                  │
     │ id                                               │ finRightCancell
     ▼                                                  ▼
   Fin b  ─────────────────────────────────────────▶  Fin b
                         id
-/
@[simp] theorem finRightCancell_comp_finRightCancell_Inv (a b : ℕ) :
    (finRightCancell a b) ∘ (finRightCancell_Inv a b) = id := by
  funext i
  simp [finRightCancell, finRightCancell_Inv, Function.comp]

/-
                   finRightCancell
   Fin (b + a - a)  ───────────────────────────────▶  Fin b
        │                                              │
        │ id                                           │ finRightCancell_Inv
        ▼                                              ▼
   Fin (b + a - a)  ───────────────────────────────▶  Fin (b + a - a)
                             id
-/
@[simp] theorem finRightCancell_Inv_comp_finRightCancell (a b : ℕ) :
    (finRightCancell_Inv a b) ∘ (finRightCancell a b) = id := by
  funext i
  simp [finRightCancell, finRightCancell_Inv, Function.comp]


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                     finSumId_X_RightCancell_Inv
   Fin a ⊕ Fin b  ───────────────────────────────────────────▶  Fin a ⊕ Fin (b + a - a)
           │                                                         │
           │ id                                                      │ finSumId_X_RightCancell
           ▼                                                         ▼
   Fin a ⊕ Fin b  ───────────────────────────────────────────▶  Fin a ⊕ Fin b
                               id
-/
@[simp] theorem finSumId_X_RightCancell_comp_Inv (a b : ℕ) :
    (finSumId_X_RightCancell a b) ∘ (finSumId_X_RightCancell_Inv a b) = id := by
  funext x
  cases x with
  | inl i =>
      simp [finSumId_X_RightCancell, finSumId_X_RightCancell_Inv, Function.comp]
  | inr j =>
      simp [finSumId_X_RightCancell, finSumId_X_RightCancell_Inv, Function.comp]
      simp [finRightCancell, finRightCancell_Inv]



-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                     finSumId_X_RightCancell
   Fin a ⊕ Fin (b + a - a)  ─────────────────────────────────▶  Fin a ⊕ Fin b
             │                                                     │
             │ id                                                  │ finSumId_X_RightCancell_Inv
             ▼                                                     ▼
   Fin a ⊕ Fin (b + a - a)  ─────────────────────────────────▶  Fin a ⊕ Fin (b + a - a)
                                   id
-/
@[simp] theorem finSumId_X_RightCancell_Inv_comp (a b : ℕ) :
    (finSumId_X_RightCancell_Inv a b) ∘ (finSumId_X_RightCancell a b) = id := by
  funext x
  cases x with
  | inl i =>
      simp [finSumId_X_RightCancell, finSumId_X_RightCancell_Inv, Function.comp]
  | inr j =>
      simp [finSumId_X_RightCancell, finSumId_X_RightCancell_Inv, Function.comp]
      simp [finRightCancell, finRightCancell_Inv]


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                   finRightSubtr_Inv
   Fin (a - b)  ───────────────────────────────────────▶  Fin (a + c - (b + c))
        │                                                     │
        │ id                                                  │ finRightSubtr
        ▼                                                     ▼
   Fin (a - b)  ───────────────────────────────────────▶  Fin (a - b)
                           id
-/
theorem finRightSubtr_finRightSubtr_Inv_is_id (a b c : ℕ) :
    (finRightSubtr a b c) ∘ (finRightSubtr_Inv a b c) = id := by
  rfl

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                     finRightSubtr
   Fin (a + c - (b + c))  ───────────────────────────▶  Fin (a - b)
            │                                              │
            │ id                                           │ finRightSubtr_Inv
            ▼                                              ▼
   Fin (a + c - (b + c))  ───────────────────────────▶  Fin (a + c - (b + c))
                               id
-/
theorem finRightSubtr_Inv_finRightSubtr_is_id (a b c : ℕ) :
    (finRightSubtr_Inv a b c) ∘ (finRightSubtr a b c) = id := by
  rfl



-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + (b + ((c + e) - (d + e))))  ─── finId_XX_Id_RightSubtr ───▶  Fin (a + (b + (c - d)))
-/
def finId_XX_Id_RightSubtr (a b c d e : ℕ) :
    Fin (a + (b + ((c + e) - (d + e)))) → Fin (a + (b + (c - d))) :=
  Fin.cast (by simp [Nat.add_sub_add_right])

-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
   Fin (a + ((b + d) - (c + d)))  ─── finId_X_RightSubtr ───▶  Fin (a + (b - c))
-/
def finId_X_RightSubtr (a b c d : ℕ) :
    Fin (a + ((b + d) - (c + d))) → Fin (a + (b - c)) :=
  Fin.cast (by simp [Nat.add_sub_add_right])



-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                 finId_X_RightCancell_Inv
   Fin (a + b)  ───────────────────────────────────▶  Fin (a + (b + a - a))
        │                                               │
        │ id                                            │ finId_X_RightCancell
        ▼                                               ▼
   Fin (a + b)  ───────────────────────────────────▶  Fin (a + b)
                         id
-/
@[simp] theorem finId_X_RightCancell_finId_X_RightCancell_Inv (a b : ℕ) :
    (finId_X_RightCancell a b) ∘ (finId_X_RightCancell_Inv a b) = id
  := by
  rfl


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                 finId_X_RightCancell
   Fin (a + (b + a - a))  ─────────────────────────▶  Fin (a + b)
              │                                        │
              │ id                                     │ finId_X_RightCancell_Inv
              ▼                                        ▼
   Fin (a + (b + a - a))  ─────────────────────────▶  Fin (a + (b + a - a))
                              id
-/
@[simp] theorem finId_X_RightCancell_Inv_finId_X_RightCancell (a b : ℕ) :
    (finId_X_RightCancell_Inv a b) ∘ (finId_X_RightCancell a b) = id
  := by
  rfl


@[simp]
theorem finAddToFinSum_Inv_finSumId_X_RightCancell_Inv_is_finId_X_RightCancell_Inv_finAddToFinSum_Inv
  (a b : ℕ) :
  (finAddToFinSum_Inv a (b + a - a)) ∘ (finSumId_X_RightCancell_Inv a b)
    =
  (finId_X_RightCancell_Inv a b) ∘ (finAddToFinSum_Inv a b)
  := by
  unfold finAddToFinSum_Inv
  unfold finId_X_RightCancell_Inv
  unfold finSumId_X_RightCancell_Inv
  unfold finRightCancell_Inv
  funext i
  simp [Function.comp]
  rcases i with ia | ib
  · -- ia : Fin a
    rfl
  · -- ib : Fin b
    rfl


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                         finId_X_RightCancell
   Fin (a + (b + a - a))  ─────────────────────────────▶  Fin (a + b)
             │                                                 │
             │ finAddToFinSum a (b + a - a)                     │ finAddToFinSum a b
             ▼                                                 ▼
   Fin a ⊕ Fin (b + a - a)  ───────── finSumId_X_RightCancell ─────────▶  Fin a ⊕ Fin b
-/
@[simp]
theorem finAddToFinSum_finId_X_RightCancell_is_finSumId_X_RightCancell_finAddToFinSum
  (a b : ℕ) :
    (finAddToFinSum a b) ∘ (finId_X_RightCancell a b)
      =
    (finSumId_X_RightCancell a b) ∘ finAddToFinSum a (b + a - a)
  := by
  have h0 :
    (finAddToFinSum_Inv a (b + a - a)) ∘ (finSumId_X_RightCancell_Inv a b)
    =
    (finId_X_RightCancell_Inv a b) ∘ (finAddToFinSum_Inv a b)
    := by
      exact finAddToFinSum_Inv_finSumId_X_RightCancell_Inv_is_finId_X_RightCancell_Inv_finAddToFinSum_Inv a b
  have h1 := compLeft (finAddToFinSum a (b + a - a)) h0
  rw [← Function.comp_assoc] at h1
  simp at h1
  have h2 := compRight (finAddToFinSum a b) h1
  rw [Function.comp_assoc, Function.comp_assoc] at h2
  have h3 := compLeft (finSumId_X_RightCancell a b) h2
  rw [← Function.comp_assoc] at h3
  simp at h3
  have h4 := compRight (finId_X_RightCancell a b) h3
  rw [Function.comp_assoc, Function.comp_assoc] at h4
  simp at h4
  exact h4


-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
/-
                         finId_X_Comm
   Fin (a + (b + c))  ─────────────────────────────────▶  Fin (a + (c + b))
            │                                                   │
            │ finAddToFinSum a (b + c)                           │ finAddToFinSum a (c + b)
            ▼                                                   ▼
   Fin a ⊕ Fin (b + c)  ───────── finSumId_X_finComm ─────────▶  Fin a ⊕ Fin (c + b)
-/
@[simp]
theorem finAddToFinSum_finId_X_Comm_is_finSumId_X_finComm_finAddToFinSum (a b c : ℕ) :
  (finAddToFinSum a (c + b)) ∘ (finId_X_Comm a b c)
  =
  (finSumId_X_finComm a b c) ∘ (finAddToFinSum a (b + c)) := by
  funext i
  unfold finAddToFinSum
  unfold finId_X_Comm
  unfold finSumId_X_finComm
  unfold finComm
  simp [Function.comp]
  refine Fin.addCases (fun ia => ?_) (fun jb => ?_) i
  · simp
  ·
    simp [Function.comp, Sum.map]
    have hbc : b + c = c + b := by
      simpa using Nat.add_comm b c
    have habc : a + (b + c) = a + (c + b) := by
      simp [hbc]
    have hcast :
        Fin.cast habc (Fin.natAdd a jb)
          =
        Fin.natAdd a (Fin.cast hbc jb) := by
      apply Fin.ext
      simp [Fin.natAdd]
    simp [hcast]

end NEO
